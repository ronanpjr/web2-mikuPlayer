<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Vocaloid Music Player</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Exo+2:wght@700&family=Inter:wght@400;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css">
    <style>
        /* Custom Styles */
        :root {
            /* Default Dark Theme Colors */
            --theme-primary: #32CDFF;
            --theme-gradient-end: #e539ab;
            --theme-shadow: rgba(50, 205, 255, 0.4);
            --theme-bg-start: #1a1a2e;
            --theme-bg-end: #0f3460;
            --body-bg: #0a0a1a;
            --text-color: #ffffff;
            --text-color-muted: rgba(255, 255, 255, 0.7);
            --text-color-faint: rgba(255, 255, 255, 0.5);
            --player-shadow: 0 10px 30px rgba(0, 0, 0, 0.5), 0 0 15px rgba(50, 205, 255, 0.2);
            --progress-bar-bg: rgba(255, 255, 255, 0.1);
            --playlist-item-hover: rgba(50, 205, 255, 0.1);
            --playlist-item-active: rgba(50, 205, 255, 0.2);
            --playlist-border: rgba(255, 255, 255, 0.08);
        }

        @media (prefers-color-scheme: light) {
            :root {
                /* Light Theme Overrides */
                --body-bg: #f0f2f5;
                --text-color: #1a1a2e;
                --text-color-muted: rgba(26, 26, 46, 0.7);
                --text-color-faint: rgba(26, 26, 46, 0.5);
                --player-shadow: 0 10px 30px rgba(0, 0, 0, 0.1), 0 0 15px rgba(0, 0, 0, 0.05);
                --progress-bar-bg: rgba(0, 0, 0, 0.1);
                --playlist-item-hover: rgba(0, 0, 0, 0.04);
                --playlist-item-active: rgba(0, 0, 0, 0.08);
                --playlist-border: rgba(0, 0, 0, 0.08);
            }
        }

        body {
            cursor: url('cursor/Normal.cur'), auto;
            font-family: 'Inter', sans-serif;
            background-color: var(--body-bg);
            color: var(--text-color);
            -webkit-font-smoothing: antialiased;
            -moz-osx-font-smoothing: grayscale;
            transition: background-color 0.5s ease, color 0.5s ease;
            overflow-x: hidden; /* Prevent horizontal scroll, allow vertical */
        }

        #bg-canvas {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            z-index: -1;
        }

        .font-orbitron {
            font-family: 'Exo 2', sans-serif;
        }
        .player-bg {
            background: linear-gradient(135deg, var(--theme-bg-start) 0%, var(--theme-bg-end) 100%);
            box-shadow: var(--player-shadow);
            transition: background 0.5s ease, box-shadow 0.5s ease;
        }
        #mainPlayerCard {
            transition: background 0.5s ease, box-shadow 0.5s ease;
        }
        #songArtist {
            color: var(--theme-primary);
            opacity: 0.8;
            transition: color 0.5s ease;
        }
        #vocaloidSinger {
            color: var(--theme-gradient-end);
            opacity: 0.7;
            transition: color 0.5s ease;
        }
        .progress-bar-container {
            background-color: var(--progress-bar-bg);
            cursor: pointer;
        }
        .progress-bar {
            background: linear-gradient(90deg, var(--theme-primary), var(--theme-gradient-end));
            transition: width 0.1s linear, background 0.5s ease;
        }
        .volume-slider::-webkit-slider-runnable-track {
            background: var(--progress-bar-bg);
        }
        .volume-slider::-webkit-slider-thumb {
            background: var(--theme-primary);
            transition: background-color 0.5s ease;
        }
        .control-btn {
            color: var(--text-color-muted);
            transition: all 0.2s ease-in-out;
        }
        .control-btn:hover {
            color: var(--theme-primary);
            transform: scale(1.1);
        }
        .play-btn {
            background: linear-gradient(135deg, var(--theme-primary), var(--theme-gradient-end));
            box-shadow: 0 0 15px var(--theme-shadow);
            color: white; /* Play button icon color should contrast with gradient */
            transition: all 0.5s ease;
        }
        .play-btn:hover {
            transform: scale(1.05);
            box-shadow: 0 0 25px var(--theme-shadow);
        }
        .playlist-item {
            border-bottom: 1px solid var(--playlist-border);
            transition: background-color 0.2s ease;
        }
        .playlist-item:hover {
            background-color: var(--playlist-item-hover);
        }
        .playlist-item.active {
            background-color: var(--playlist-item-active);
            border-left: 3px solid var(--theme-primary);
            transition: border-color 0.5s ease, background-color 0.2s ease;
        }
        .playlist-container::-webkit-scrollbar, #lyricsContent::-webkit-scrollbar {
            width: 6px;
        }
        .playlist-container::-webkit-scrollbar-track, #lyricsContent::-webkit-scrollbar-track {
            background: rgba(0,0,0,0.2);
        }
        .playlist-container::-webkit-scrollbar-thumb, #lyricsContent::-webkit-scrollbar-thumb {
            background: var(--theme-primary);
            border-radius: 3px;
            transition: background-color 0.5s ease;
        }
        .muted-text {
            color: var(--text-color-muted);
        }
        .faint-text {
             color: var(--text-color-faint);
        }
    </style>
</head>
<body class="flex items-center justify-center min-h-screen p-4">
    <canvas id="bg-canvas"></canvas>
    <!-- Audio element for playback -->
    <audio id="audioPlayer"></audio>

    <div class="w-full max-w-4xl mx-auto grid grid-cols-1 lg:grid-cols-3 gap-8">
        <!-- Main Player UI -->
        <div id="mainPlayerCard" class="lg:col-span-2 player-bg rounded-2xl p-6 md:p-8 flex flex-col relative overflow-hidden">
            
            <!-- Display Area: Toggles between Album Art and Lyrics -->
            <div id="displayArea" class="flex-grow flex flex-col justify-center text-center relative">
                <!-- Art View -->
                <div id="artView" class="transition-opacity duration-500">
                    <div id="albumArtContainer" class="relative w-48 h-48 md:w-64 md:h-64 mx-auto mb-6 cursor-pointer group">
                        <img id="albumArt" src="images/default_art.png" alt="Album Art" class="w-full h-full rounded-full shadow-2xl object-cover transition-all duration-500 transform group-hover:scale-105 outline outline-2 outline-offset-2 outline-white/75">
                    </div>
                    <h1 id="songTitle" class="font-orbitron text-2xl md:text-3xl font-bold tracking-wider truncate">Select a Song</h1>
                    <h2 id="songArtist" class="text-md md:text-lg mt-1 truncate">Vocaloid Producer</h2>
                    <p id="vocaloidSinger" class="text-sm">Vocaloid</p>
                </div>

                <!-- Lyrics View -->
                <div id="lyricsView" class="absolute inset-0 w-full h-full flex flex-col opacity-0 pointer-events-none transition-opacity duration-500 bg-black/30 backdrop-blur-sm rounded-2xl">
                    <button id="closeLyricsBtn" class="absolute top-4 right-4 text-white/50 hover:text-white transition-colors z-10">
                        <i class="fas fa-times text-2xl"></i>
                    </button>
                    <h2 id="lyricsTitle" class="font-orbitron text-3xl font-bold mb-2 text-center flex-shrink-0 pt-6"></h2>
                    <h3 id="lyricsArtist" class="text-lg mb-6 text-center text-white/70 flex-shrink-0"></h3>
                    <div id="lyricsContent" class="text-center text-lg leading-relaxed flex-grow overflow-y-auto px-6 pb-6">
                        <!-- Lyrics will be injected here -->
                    </div>
                </div>
            </div>

            <!-- Controls Area: Always Visible -->
            <div id="controlsArea" class="flex-shrink-0 pt-4">
                <!-- Progress Bar and Timers -->
                <div class="mb-4">
                    <div id="progressBarContainer" class="progress-bar-container w-full h-2 rounded-full overflow-hidden">
                        <div id="progressBar" class="progress-bar h-full rounded-full"></div>
                    </div>
                    <div class="flex justify-between text-xs mt-2 faint-text">
                        <span id="currentTime">0:00</span>
                        <span id="totalDuration">0:00</span>
                    </div>
                </div>

                <!-- Controls -->
                <div class="flex items-center justify-center space-x-6 md:space-x-10">
                    <button id="prevBtn" class="control-btn text-2xl md:text-3xl">
                        <i class="fas fa-backward-step"></i>
                    </button>
                    <button id="playPauseBtn" class="control-btn play-btn text-3xl md:text-4xl w-16 h-16 md:w-20 md:h-20 rounded-full flex items-center justify-center shadow-lg">
                        <i id="playIcon" class="fas fa-play"></i>
                        <i id="pauseIcon" class="fas fa-pause hidden"></i>
                    </button>
                    <button id="nextBtn" class="control-btn text-2xl md:text-3xl">
                        <i class="fas fa-forward-step"></i>
                    </button>
                </div>

                 <!-- Volume Control -->
                <div class="flex items-center justify-center space-x-3 mt-6 w-full max-w-xs mx-auto faint-text">
                    <i class="fas fa-volume-down"></i>
                    <input type="range" id="volumeSlider" class="volume-slider w-full h-1.5 rounded-lg appearance-none cursor-pointer" min="0" max="1" step="0.01" value="0.75">
                    <i class="fas fa-volume-up"></i>
                </div>
            </div>
        </div>

        <!-- Playlist -->
        <div class="player-bg rounded-2xl p-4 md:p-6 flex flex-col">
            <h3 class="font-orbitron text-xl font-bold mb-4 flex-shrink-0">Playlist</h3>
            <div id="playlistContainer" class="playlist-container overflow-y-auto flex-grow">
                <!-- Playlist items will be injected here by JavaScript -->
            </div>
        </div>
    </div>

    <script>
        document.addEventListener('DOMContentLoaded', () => {
            const root = document.documentElement;
            const audioPlayer = document.getElementById('audioPlayer');
            const playPauseBtn = document.getElementById('playPauseBtn');
            const playIcon = document.getElementById('playIcon');
            const pauseIcon = document.getElementById('pauseIcon');
            const prevBtn = document.getElementById('prevBtn');
            const nextBtn = document.getElementById('nextBtn');
            const progressBarContainer = document.getElementById('progressBarContainer');
            const progressBar = document.getElementById('progressBar');
            const currentTimeEl = document.getElementById('currentTime');
            const totalDurationEl = document.getElementById('totalDuration');
            const volumeSlider = document.getElementById('volumeSlider');
            const albumArtContainer = document.getElementById('albumArtContainer');
            const albumArt = document.getElementById('albumArt');
            const songTitle = document.getElementById('songTitle');
            const songArtist = document.getElementById('songArtist');
            const vocaloidSinger = document.getElementById('vocaloidSinger');
            const playlistContainer = document.getElementById('playlistContainer');
            const mainPlayerCard = document.getElementById('mainPlayerCard');
            
            // View Elements
            const artView = document.getElementById('artView');
            const lyricsView = document.getElementById('lyricsView');
            const closeLyricsBtn = document.getElementById('closeLyricsBtn');
            const lyricsTitle = document.getElementById('lyricsTitle');
            const lyricsArtist = document.getElementById('lyricsArtist');
            const lyricsContent = document.getElementById('lyricsContent');
            
            // --- Canvas Background ---
            const canvas = document.getElementById('bg-canvas');
            const ctx = canvas.getContext('2d');
            let triangles = [];
            let triangleColors = ['#32CDFF', '#e539ab', '#ffffff'];

            function resizeCanvas() {
                canvas.width = window.innerWidth;
                canvas.height = window.innerHeight;
            }
            resizeCanvas();
            window.addEventListener('resize', resizeCanvas);
            
            class Triangle {
                constructor() {
                    this.x = Math.random() * canvas.width;
                    this.y = Math.random() * canvas.height;
                    this.size = Math.random() * 20 + 10;
                    this.color = triangleColors[Math.floor(Math.random() * triangleColors.length)];
                    this.vx = (Math.random() - 0.5) * 0.5;
                    this.vy = (Math.random() - 0.5) * 0.5;
                    this.angle = Math.random() * Math.PI * 2;
                    this.rotationSpeed = (Math.random() - 0.5) * 0.01;
                }

                update() {
                    this.x += this.vx;
                    this.y += this.vy;
                    this.angle += this.rotationSpeed;

                    if (this.x < -this.size) this.x = canvas.width + this.size;
                    if (this.x > canvas.width + this.size) this.x = -this.size;
                    if (this.y < -this.size) this.y = canvas.height + this.size;
                    if (this.y > canvas.height + this.size) this.y = -this.size;
                }

                draw() {
                    ctx.save();
                    ctx.translate(this.x, this.y);
                    ctx.rotate(this.angle);
                    ctx.beginPath();
                    ctx.moveTo(0, -this.size / 1.5);
                    ctx.lineTo(-this.size / 1.5, this.size / 1.5);
                    ctx.lineTo(this.size / 1.5, this.size / 1.5);
                    ctx.closePath();
                    ctx.fillStyle = this.color;
                    ctx.globalAlpha = 0.5;
                    ctx.fill();
                    ctx.restore();
                }
            }

            function createTriangles(colors) {
                triangleColors = colors;
                triangles = [];
                for (let i = 0; i < 50; i++) {
                    triangles.push(new Triangle());
                }
            }

            function animate() {
                ctx.clearRect(0, 0, canvas.width, canvas.height);
                triangles.forEach(triangle => {
                    triangle.update();
                    triangle.draw();
                });
                requestAnimationFrame(animate);
            }
            
            // --- End Canvas Background ---

            // --- Playlist Data ---
            const playlist = [
                {
                    title: "World is Mine", artist: "ryo (supercell)", singer: "Hatsune Miku", duration: "4:14",
                    src: "https://ia800905.us.archive.org/9/items/Vocaloid-worldIsMine/Vocaloid-worldIsMine.mp3",
                    art: "images/world_is_mine.png",
                    lyrics: `Sekai de ichiban ohime-sama<br>
                        Sou iu atsukai kokoroete yo ne<br><br>
                        Sono ichi itsumo to chigau kamigata ni ki ga tsuku koto<br>
                        Sono ni chanto kutsu made miru koto ii ne?<br>
                        Sono san watashi no hitokoto ni wa mittsu no kotoba de henji suru koto<br>
                        Wakattara migite ga orusu na no wo nantoka shite!`,
                    theme: { 
                        primary: '#32CDFF', gradientEnd: '#87ceeb', shadow: 'rgba(50, 205, 255, 0.4)', bgStart: '#1a1a2e', bgEnd: '#0f3460',
                        light: { primary: '#00A8E8', gradientEnd: '#007EA7', shadow: 'rgba(0, 168, 232, 0.3)', bgStart: '#ffffff', bgEnd: '#e0f7ff' },
                        triangles: ['#32CDFF', '#87ceeb', '#ff69b4', '#ffffff']
                    }
                },
                {
                    title: "Echo", artist: "Crusher-P", singer: "GUMI English", duration: "3:58",
                    src: "https://ia800201.us.archive.org/16/items/VocaloidGumiEcho/Vocaloid%20Gumi%20-%20Echo.mp3",
                    art: "images/echo.png",
                    lyrics: `The clock stopped ticking, forever ago<br>
                        How long have I been up? I don't know<br>
                        I can't get a grip, but I can't let go<br>
                        There wasn't anything to hold on to, though<br><br>
                        Why can't I see? Why can't I see?<br>
                        All the colors that you see?<br>
                        Please can I be? Please can I be?<br>
                        Colorful and free?`,
                    theme: { 
                        primary: '#45b39d', gradientEnd: '#2ecc71', shadow: 'rgba(69, 179, 157, 0.4)', bgStart: '#1a2e2a', bgEnd: '#163e3b',
                        light: { primary: '#27ae60', gradientEnd: '#16a085', shadow: 'rgba(39, 174, 96, 0.3)', bgStart: '#ffffff', bgEnd: '#e8f8f5' },
                        triangles: ['#45b39d', '#2ecc71', '#f1c40f', '#ffffff']
                     }
                },
                {
                    title: "Remote Control", artist: "Jesus-P", singer: "Kagamine Rin & Len", duration: "5:04",
                    src: "https://ia801308.us.archive.org/29/items/KagamineRinLenRemoteControl/Kagamine%20Rin%20%26%20Len%20-%20Remote%20Control.mp3",
                    art: "images/remote_control.png",
                    lyrics: `Mawari wa anmari kankeinai<br>
                        Jibun wa jibun da shi<br>
                        Dakedo chotto dake ki ni naru kana<br>
                        Tonari no shibafu ga<br><br>
                        Te ni ireta mono to hikikae ni shite<br>
                        Kirisutete kita mono<br>
                        Takusan arunda`,
                    theme: { 
                        primary: '#f1c40f', gradientEnd: '#f7dc6f', shadow: 'rgba(241, 196, 15, 0.4)', bgStart: '#3e3516', bgEnd: '#2e2a1a',
                        light: { primary: '#f39c12', gradientEnd: '#e67e22', shadow: 'rgba(243, 156, 18, 0.3)', bgStart: '#ffffff', bgEnd: '#fff9e6' },
                        triangles: ['#f1c40f', '#f7dc6f', '#3498db', '#ffffff']
                    }
                },
                 {
                    title: "Just Be Friends", artist: "Dixie Flatline", singer: "Megurine Luka", duration: "5:01",
                    src: "https://ia600205.us.archive.org/10/items/JustBeFriends/Luka-JustBeFriends.mp3",
                    art: "images/just_be_friends.png",
                    lyrics: `Just be friends, all we gotta do<br>
                        Just be friends, it's time to say goodbye<br>
                        Just be friends, all we gotta do<br>
                        Just be friends, just be friends...<br><br>
                        Ukanda n da kinou no asa hayaku ni<br>
                        Wareta gurasu kakiatsumeru you na<br>
                        Kore wa ittai nandarou kitta yubi karaしたたる shizuku<br>
                        Bokura wa konna koto shitakatta no kana`,
                    theme: { 
                        primary: '#e539ab', gradientEnd: '#f4a1d8', shadow: 'rgba(229, 57, 171, 0.4)', bgStart: '#3e1633', bgEnd: '#2e1a2b',
                        light: { primary: '#d81b60', gradientEnd: '#c2185b', shadow: 'rgba(216, 27, 96, 0.3)', bgStart: '#ffffff', bgEnd: '#fce4ec' },
                        triangles: ['#e539ab', '#f4a1d8', '#8e44ad', '#ffffff']
                    }
                },
                {
                    title: "Yoshiwara Lament", artist: "Asa-P", singer: "Kasane Teto", duration: "3:51",
                    src: "https://archive.org/download/yoshiwara-lament-asa-feat.-kasane-teto/Yoshiwara%20Lament%20-%20Asa%20feat.%20Kasane%20Teto.mp3",
                    art: "images/yoshiwara_lament.png",
                    lyrics: `Akai keshō de aza wo kakushita<br>
                        Yōen na emi no uragawa wa<br>
                        Kowareta kokoro tataki tsukete mo<br>
                        Dare ni mo todokanai<br><br>
                        Yoshiwara no yoru ni saku<br>
                        Utsukushī adabana yo<br>
                        Aa, hakanaku chiri yuku no ga sadame to shite`,
                    theme: { 
                        primary: '#c0392b', gradientEnd: '#e74c3c', shadow: 'rgba(192, 57, 43, 0.4)', bgStart: '#3e161f', bgEnd: '#2e1a1a',
                        light: { primary: '#e74c3c', gradientEnd: '#c0392b', shadow: 'rgba(231, 76, 60, 0.3)', bgStart: '#ffffff', bgEnd: '#fbe9e7' },
                        triangles: ['#c0392b', '#e74c3c', '#f1c40f', '#ffffff']
                    }
                }
            ];

            let currentSongIndex = 0;
            let isPlaying = false;
            let isLyricsVisible = false;

            function setTheme(theme) {
                const isLight = window.matchMedia('(prefers-color-scheme: light)').matches;
                const currentTheme = isLight && theme.light ? theme.light : theme;
                
                root.style.setProperty('--theme-primary', currentTheme.primary);
                root.style.setProperty('--theme-gradient-end', currentTheme.gradientEnd);
                root.style.setProperty('--theme-shadow', currentTheme.shadow);
                root.style.setProperty('--theme-bg-start', currentTheme.bgStart);
                root.style.setProperty('--theme-bg-end', currentTheme.bgEnd);

                createTriangles(theme.triangles);
            }

            function loadSong(song) {
                songTitle.textContent = song.title;
                songArtist.textContent = song.artist;
                vocaloidSinger.textContent = song.singer;
                albumArt.src = song.art;
                audioPlayer.src = song.src;
                audioPlayer.volume = volumeSlider.value;
                setTheme(song.theme);
                updatePlaylistUI();

                mainPlayerCard.style.background = `
                    linear-gradient(160deg, rgba(0, 0, 0, 0.5) 0%, rgba(0, 0, 0, 1) 90%),
                    url('${song.art}')
                `;
                mainPlayerCard.style.backgroundSize = 'cover';
                mainPlayerCard.style.backgroundPosition = 'center';

                // Reset lyrics view when song changes
                if (isLyricsVisible) {
                    toggleLyricsView();
                }
            }

            function playSong() {
                isPlaying = true;
                playIcon.classList.add('hidden');
                pauseIcon.classList.remove('hidden');
                audioPlayer.play();
            }

            function pauseSong() {
                isPlaying = false;
                playIcon.classList.remove('hidden');
                pauseIcon.classList.add('hidden');
                audioPlayer.pause();
            }
            
            function prevSong() {
                currentSongIndex = (currentSongIndex - 1 + playlist.length) % playlist.length;
                loadSong(playlist[currentSongIndex]);
                playSong();
            }

            function nextSong() {
                currentSongIndex = (currentSongIndex + 1) % playlist.length;
                loadSong(playlist[currentSongIndex]);
                playSong();
            }
            
            function updateProgress(e) {
                const { duration, currentTime } = e.srcElement;
                if (!isNaN(duration)) {
                    const progressPercent = (currentTime / duration) * 100;
                    progressBar.style.width = `${progressPercent}%`;
                    totalDurationEl.textContent = formatTime(duration);
                    currentTimeEl.textContent = formatTime(currentTime);
                }
            }

            function setProgress(e) {
                const width = this.clientWidth;
                const clickX = e.offsetX;
                const duration = audioPlayer.duration;
                if (!isNaN(duration)) {
                    audioPlayer.currentTime = (clickX / width) * duration;
                }
            }
            
            function formatTime(seconds) {
                const minutes = Math.floor(seconds / 60);
                const secs = Math.floor(seconds % 60);
                return `${minutes}:${secs < 10 ? '0' : ''}${secs}`;
            }

            function setVolume() {
                audioPlayer.volume = volumeSlider.value;
            }

            function renderPlaylist() {
                playlistContainer.innerHTML = '';
                playlist.forEach((song, index) => {
                    const songEl = document.createElement('div');
                    songEl.classList.add('playlist-item', 'p-3', 'cursor-pointer', 'flex', 'items-center', 'gap-4');
                    songEl.setAttribute('data-index', index);
                    
                    songEl.innerHTML = `
                        <img src="${song.art}" alt="${song.title}" class="w-12 h-12 rounded-full object-cover outline outline-1 outline-offset-1 outline-white/75">
                        <div class="flex-grow overflow-hidden">
                            <p class="font-semibold truncate">${song.title}</p>
                            <p class="text-sm muted-text truncate">${song.singer}</p>
                        </div>
                        <span class="text-sm faint-text flex-shrink-0">${song.duration}</span>
                    `;
                    
                    songEl.addEventListener('click', () => {
                        currentSongIndex = index;
                        loadSong(playlist[currentSongIndex]);
                        playSong();
                    });
                    playlistContainer.appendChild(songEl);
                });
                updatePlaylistUI();
            }

            function updatePlaylistUI() {
                const items = document.querySelectorAll('.playlist-item');
                items.forEach((item, index) => {
                    if (index === currentSongIndex) {
                        item.classList.add('active');
                    } else {
                        item.classList.remove('active');
                    }
                });
            }

            function toggleLyricsView() {
                isLyricsVisible = !isLyricsVisible;
                const song = playlist[currentSongIndex];
                
                if (isLyricsVisible) {
                    lyricsTitle.textContent = song.title;
                    lyricsArtist.textContent = `${song.artist} ft. ${song.singer}`;
                    lyricsContent.innerHTML = song.lyrics;
                    
                    artView.classList.add('opacity-0', 'pointer-events-none');
                    lyricsView.classList.remove('opacity-0', 'pointer-events-none');
                } else {
                    artView.classList.remove('opacity-0', 'pointer-events-none');
                    lyricsView.classList.add('opacity-0', 'pointer-events-none');
                }
            }

            // --- Event Listeners ---
            playPauseBtn.addEventListener('click', () => isPlaying ? pauseSong() : playSong());
            prevBtn.addEventListener('click', prevSong);
            nextBtn.addEventListener('click', nextSong);
            audioPlayer.addEventListener('timeupdate', updateProgress);
            audioPlayer.addEventListener('ended', nextSong);
            progressBarContainer.addEventListener('click', setProgress);
            volumeSlider.addEventListener('input', setVolume);
            window.matchMedia('(prefers-color-scheme: light)').addEventListener('change', () => {
                setTheme(playlist[currentSongIndex].theme);
            });
            albumArtContainer.addEventListener('click', toggleLyricsView);
            closeLyricsBtn.addEventListener('click', toggleLyricsView);

            // --- Initialisation ---
            renderPlaylist();
            loadSong(playlist[currentSongIndex]);
            animate(); // Start the canvas animation
        });
    </script>
</body>
</html>

